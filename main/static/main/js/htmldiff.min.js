/**
 * htmldiff.js a diff algorithm that understands HTML, and produces HTML in the browser.
 *
 * MODIFIED BY Ty Mees to expose part of it's internal API and provide
 * methods to only show changes in the original text
 *
 * @author https://github.com/tnwinc
 * @see https://github.com/tnwinc/htmldiff.js
 */
(function(){var e,n,t,r,i,o,a,_,f,s,u,l,h,c,d,p,b,g,v;f=function(e){return">"===e},s=function(e){return"<"===e},l=function(e){return/^\s+$/.test(e)},u=function(e){return/^\s*<[^>]+>\s*$/.test(e)},h=function(e){return!u(e)},e=function(){return function(e,n,t){this.start_in_before=e,this.start_in_after=n,this.length=t,this.end_in_before=this.start_in_before+this.length-1,this.end_in_after=this.start_in_after+this.length-1}}(),_=function(e){var n,t,r,i,o,a;for(r="char",t="",i=[],o=0,a=e.length;o<a;o++)switch(n=e[o],r){case"tag":f(n)?(t+=">",i.push(t),t="",r=l(n)?"whitespace":"char"):t+=n;break;case"char":s(n)?(t&&i.push(t),t="<",r="tag"):/\s/.test(n)?(t&&i.push(t),t=n,r="whitespace"):/[\w\#@]+/i.test(n)?t+=n:(t&&i.push(t),t=n);break;case"whitespace":s(n)?(t&&i.push(t),t="<",r="tag"):l(n)?t+=n:(t&&i.push(t),t=n,r="char");break;default:throw new Error("Unknown mode "+r)}return t&&i.push(t),i},o=function(n,t,r,i,o,a,_){var f,s,u,l,h,c,d,p,b,g,v,w,m;for(s=i,f=a,u=0,p={},h=v=i;i<=o?v<o:v>o;h=i<=o?++v:--v){for(g={},w=0,m=(c=r[n[h]]).length;w<m;w++)if(!((l=c[w])<a)){if(l>=_)break;null==p[l-1]&&(p[l-1]=0),b=p[l-1]+1,g[l]=b,b>u&&(s=h-b+1,f=l-b+1,u=b)}p=g}return 0!==u&&(d=new e(s,f,u)),d},d=function(e,n,t,r,i,a,_,f){var s;return null!=(s=o(e,0,t,r,i,a,_))&&(r<s.start_in_before&&a<s.start_in_after&&d(e,n,t,r,s.start_in_before,a,s.start_in_after,f),f.push(s),s.end_in_before<=i&&s.end_in_after<=_&&d(e,n,t,s.end_in_before+1,i,s.end_in_after+1,_,f)),f},r=function(e){var n,t,r,i,o,a;if(null==e.find_these)throw new Error("params must have find_these key");if(null==e.in_these)throw new Error("params must have in_these key");for(t={},i=0,o=(a=e.find_these).length;i<o;i++)for(t[r=a[i]]=[],n=e.in_these.indexOf(r);-1!==n;)t[r].push(n),n=e.in_these.indexOf(r,n+1);return t},a=function(e,n){var t,i;return i=[],t=r({find_these:e,in_these:n}),d(e,n,t,0,e.length,0,n.length,i)},n=function(n,t){var r,i,o,_,f,s,u,l,h,c,d,p,b,g,v,w;if(null==n)throw new Error("before_tokens?");if(null==t)throw new Error("after_tokens?");for(d=c=0,h=[],r={"false,false":"replace","true,false":"insert","false,true":"delete","true,true":"none"},(u=a(n,t)).push(new e(n.length,t.length,0)),o=b=0,v=u.length;b<v;o=++b)"none"!==(i=r[[d===(s=u[o]).start_in_before,c===s.start_in_after].toString()])&&h.push({action:i,start_in_before:d,end_in_before:"insert"!==i?s.start_in_before-1:void 0,start_in_after:c,end_in_after:"delete"!==i?s.start_in_after-1:void 0}),0!==s.length&&h.push({action:"equal",start_in_before:s.start_in_before,end_in_before:s.end_in_before,start_in_after:s.start_in_after,end_in_after:s.end_in_after}),d=s.end_in_before+1,c=s.end_in_after+1;for(p=[],f={action:"none"},_=function(e){return"equal"===e.action&&(e.end_in_before-e.start_in_before==0&&/^\s$/.test(n.slice(e.start_in_before,+e.end_in_before+1||9e9)))},g=0,w=h.length;g<w;g++)_(l=h[g])&&"replace"===f.action||"replace"===l.action&&"replace"===f.action?(f.end_in_before=l.end_in_before,f.end_in_after=l.end_in_after):(p.push(l),f=l);return p},t=function(e,n,t){var r,i,o,a,_;for(o=void 0,i=a=0,_=(n=n.slice(e,+n.length+1||9e9)).length;a<_&&(!0===(r=t(n[i]))&&(o=i),!1!==r);i=++a);return null!=o?n.slice(0,+o+1||9e9):[]},v=function(e,n){var r,i,o,a,_;for(a="",o=0,r=n.length;!(o>=r||(o+=(i=t(o,n,h)).length,0!==i.length&&(a+="<"+e+">"+i.join("")+"</"+e+">"),o>=r));)o+=(_=t(o,n,u)).length,a+=_.join("");return a},(c={equal:function(e,n,t){return n.slice(e.start_in_before,+e.end_in_before+1||9e9).join("")},insert:function(e,n,t){var r;return r=t.slice(e.start_in_after,+e.end_in_after+1||9e9),v("ins",r)},delete:function(e,n,t){var r;return r=n.slice(e.start_in_before,+e.end_in_before+1||9e9),v("del",r)}}).replace=function(e,n,t){return c.delete(e,n,t)+c.insert(e,n,t)},g=function(e,n,t){var r,i,o,a;for(i="",o=0,a=t.length;o<a;o++)r=t[o],i+=c[r.action](r,e,n);return i},b=function(e,n,t){var r,i,o,a,_;for(o="",a=0,_=t.length;a<_;a++)"insert"!==(r=(i=t[a]).action)&&("replace"===r&&(r="delete"),o+=c[r](i,e,n));return o},p=function(e,n,t){var r,i,o,a,_;for(o="",a=0,_=t.length;a<_;a++)"delete"!==(r=(i=t[a]).action)&&("replace"===r&&(r="insert"),o+=c[r](i,e,n));return o},(i=function(e,t){var r;return e===t?e:(e=_(e),t=_(t),r=n(e,t),g(e,t,r))}).html_to_tokens=_,i.find_matching_blocks=a,a.find_match=o,a.create_index=r,i.calculate_operations=n,i.render_operations=g,"function"==typeof define?define([],function(){return i}):"undefined"!=typeof module&&null!==module?(module.exports=i,module.html_to_tokens=_,module.calculate_operations=n,module.render_operations=g):(this.htmldiff=i,this.html_to_tokens=_,this.calculate_operations=n,this.render_operations=g,this.render_before_operations=b,this.render_after_operations=p)}).call(this);