{% load staticfiles %}

<script>
function depends_on_value(a, a_value, b)
{
    $('input[name=' + a + ']').change(function() {
        var check = $('input[name=' + a + ']:checked').val() == a_value;
        $('#id_' + b).parent().parent().toggle(check);
    });
    $('input[name=' + a + ']').change();
}

// Checks whether a field is required given the selected inputs
function check_field_required(input_name, required_field, url)
{
    $('input[name=' + input_name + ']').change(function() {
        var checked_inputs = $('input[name=' + input_name + ']:checked').map(function() {
            return this.value;
        }).get();
        $.post(url, {'value': checked_inputs}, function(data) {
            $('#id_' + required_field).parent().parent().toggle(data.result);
        });
    });
    $('input[name=' + input_name + ']').change();
}

// TODO: deprecated, use check_field_required
function depends_on_list_value(a, a_value, b)
{
    $('input[name=' + a + ']').change(function() {
        var values = $('input[name=' + a + ']:checked').map(function() {
            return this.value;
        }).get();
        $('#id_' + b).parent().parent().toggle(intersect(values, a_value).length > 0);
    });
    $('input[name=' + a + ']').change();
}

// TODO: deprecated, see above
function intersect(a, b)
{
    return a.filter(function (e) {
        if (b.indexOf(e) !== -1) return true;
    });
}

// Adds a title row to a form field
function add_title(field, title)
{
    var insert = $('<tr>').append($('<th>').append($('<strong>').text(title))).append($('<td>'));
    $('#id_' + field).parents('tr').before(insert);
}

$(function() {
    // Will put help texts as a tooltip on an information image
    $("[id^=id]").each(function() { 
        var help = $(this).nextAll('.helptext'); 
        if (help.html()) 
        {
            $(this).after('<img src="{% static 'proposals/images/information.png' %}">');
            $(this).next().qtip({
                content: {
                    text: help.html()
                }
            });
            help.hide();
        }
    });

    // Will make every table a pure-table
    $("form table").addClass("pure-table pure-table-horizontal");
    // Will make evey form a pure-form
    $("form").addClass("pure-form");
});
</script>
