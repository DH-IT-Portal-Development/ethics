{% extends "easy_pdf/base.html" %}

{% load i18n %}
{% load proposal_filters %}

{% block extra_style %}
    <style type="text/css">
        #content table {
            border-top-width: .5px;
            border-top-style: solid;
            border-top-color: #cbcbcb;
            border-right-width: .5px;
            border-right-style: solid;
            border-right-color: #cbcbcb;
            border-bottom-width: .5px;
            border-bottom-style: solid;
            border-bottom-color: #cbcbcb;
            border-left-width: .5px;
            border-left-style: solid;
            border-left-color: #cbcbcb;
        }

        #content th, td {
            font-weight: normal;
            text-align: left;
            padding-top: 3px;
            padding-right: 3px;
            padding-bottom: 3px;
            padding-left: 3px;
        }

        #content th {
            font-weight: normal;
            text-align: left;
        }

        #content li {
            line-height: 10px;
        }
    </style>
{% endblock %}

{% block page_header %}
<div id="page-header">
ETCL - <em>{{ proposal.title }}</em> (referentienummer {{ proposal.reference_number }})
</div>
{% endblock %}

{% block page_foot %}
Pagina <pdf:pagenumber /> van <pdf:pagecount />
{% endblock %}

{% block content %}
<div id="content">
    <div class="main">
        <h1>Referentienummer {{ proposal.reference_number }}</h1>
        <h2>{% trans "Algemene informatie over de studie" %}</h2>
        <table id="test">
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "relation" %}</th><td>{{ proposal.relation }}</td>
            </tr>
            {% if proposal.relation.needs_supervisor %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "supervisor" %}</th><td>{{ proposal.supervisor.get_full_name }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "other_applicants" %}</th><td>{{ proposal.other_applicants|yesno:_("ja,nee") }}</td>
            </tr>
            {% if proposal.other_applicants %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "applicants" %}</th><td>{{ proposal.applicants.all|unordered_list }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "other_stakeholders" %}</th><td>{{ proposal.other_stakeholders|yesno:_("ja,nee") }}</td>
            </tr>
            {% if proposal.other_stakeholders %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "stakeholders" %}</th><td>{{ proposal.stakeholders }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "date_start" %}</th><td>{{ proposal.date_start }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "title" %}</th><td>{{ proposal.title }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "summary" %}</th><td>{{ proposal.summary }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "funding" %}</th><td>{{ proposal.funding.all|unordered_list }}</td>
            </tr>
            {% if proposal.funding.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "funding_details" %}</th><td></td>
            </tr>
            {% endif %}
        </table>

        {% with wmo=proposal.wmo %}
        <pdf:nextpage />
        <h2>{% trans "Ook ethische toetsing door de METC nodig?" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "metc" %}</th><td>{{ wmo.metc|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            {% if wmo.metc %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "metc_institution" %}</th><td>{{ wmo.metc_institution }}</td>
            </tr>
            {% else %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "is_medical" %}</th><td>{{ wmo.is_medical|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            {% if wmo.is_medical %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "is_behavioristic" %}</th><td>{{ wmo.is_behavioristic|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            {% endif %}
            {% endif %}
            {% if wmo.status != wmo.NO_WMO %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "metc_application" %}</th><td>{{ wmo.metc_application }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "wmo" "metc_decision" %}</th><td>{{ wmo.metc_decision }}</td>
            </tr>
            {% endif %}
        </table>
        {% endwith %}

        <pdf:nextpage />
        <h2>{% trans "EÃ©n of meerdere trajecten?" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "has_multiple_groups" %}</th><td>{{ proposal.has_multiple_groups|yesno:_("ja,nee") }}</td>
            </tr>
            {% if proposal.has_multiple_groups %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "has_multiple_trajectories" %}</th><td>{{ proposal.has_multiple_trajectories|yesno:_("ja,nee") }}</td>
            </tr>
            {% if proposal.has_multiple_trajectories %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "studies_number" %}</th><td>{{ proposals.studies_number }}</td>
            </tr>
            {% endif %}
            {% endif %}
        </table>

        {% if proposal.wmo.status == proposal.wmo.NO_WMO %}
        {% for study in proposal.study_set.all %}
        <pdf:nextpage />
        <h2>
            {% blocktrans with order=study.order %}
            Informatie over deelnemersgroep {{ order }}
            {% endblocktrans %}
        </h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "age_groups" %}</th><td>{{ study.age_groups.all|unordered_list }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "legally_incapable" %}</th><td>{{ study.legally_incapable|yesno:_("ja,nee") }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "has_traits" %}</th><td>{{ study.has_traits|yesno:_("ja,nee") }}</td>
            </tr>
            {% if study.has_traits %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "traits" %}</th><td>{{ study.traits.all|unordered_list }}</td>
            </tr>
            {% if study.recruitment.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "traits_details" %}</th><td>{{ study.traits_details }}</td>
            </tr>
            {% endif %}
            {% endif %}
            {% if study|necessity_required %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "necessity" %}</th><td>{{ study.necessity|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "necessity_reason" %}</th><td>{{ study.necessity_reason }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "recruitment" %}</th><td>{{ study.recruitment.all|unordered_list }}</td>
            </tr>
            {% if study.recruitment.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "recruitment_details" %}</th><td>{{ study.recruitment_details }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "setting" %}</th><td>{{ study.setting.all|unordered_list }}</td>
            </tr>
            {% if study.setting.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "setting_details" %}</th><td>{{ study.setting_details }}</td>
            </tr>
            {% endif %}
            {% if study.setting.all|needs_details:"needs_supervision" %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "supervision" %}</th><td>{{ study.supervision|yesno:_("ja,nee") }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "compensation" %}</th><td>{{ study.compensation }}</td>
            </tr>
            {% if study.compensation.needs_details %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "compensation_details" %}</th><td>{{ study.compensation_details }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "passive_consent" %}</th><td>{{ study.passive_consent|yesno:_("ja,nee") }}</td>
            </tr>
        </table>

        {% if study.has_observation %}
        {% with observation=study.observation %}
        <pdf:nextpage />
        <h2>{% trans "Nadere specificatie van de observatiestudie (of het observatieonderzoeksdeel van de studie)" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "days" %}</th><td>{{ observation.days }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "mean_hours" %}</th><td>{{ observation.mean_hours }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "is_anonymous" %}</th><td>{{ observation.is_anonymous|yesno:_("ja,nee") }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "is_in_target_group" %}</th><td>{{ observation.is_in_target_group|yesno:_("ja,nee") }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "is_nonpublic_space" %}</th><td>{{ observation.is_nonpublic_space|yesno:_("ja,nee") }}</td>
            </tr>
            {% if observation.is_nonpublic_space %}
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "has_advanced_consent" %}</th><td>{{ observation.has_advanced_consent|yesno:_("ja,nee") }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "needs_approval" %}</th><td>{{ observation.needs_approval|yesno:_("ja,nee") }}</td>
            </tr>
            {% if observation.needs_approval %}
            <tr>
                <th>{% get_verbose_field_name "observations" "observation" "approval_institution" %}</th><td></td>
            </tr>
            {% endif %}
        </table>
        {% for location in observation.location_set.all %}
        <h3>{% trans "Locatie" %}</h3>
        <table>
            <tr>
                <th>{% get_verbose_field_name "observations" "location" "name" %}</th><td>{{ location.name }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "observations" "location" "registrations" %}</th><td>{{ location.registrations.all|unordered_list }}</td>
            </tr>
            {% if location.registrations.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "observations" "location" "registrations_details" %}</th><td>{{ location.registrations_details }}</td>
            </tr>
            {% endif %}
        </table>
        {% endfor %}
        {% endwith %}
        {% endif %}

        {% if study.has_intervention %}
        {% with intervention=study.intervention %}
        <pdf:nextpage />
        <h2>{% trans "Nadere specificatie van de interventiestudie (of het interventieonderzoeksdeel van de studie)" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "interventions" "intervention" "description" %}</th><td>{{ intervention.description }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "interventions" "intervention" "has_drawbacks" %}</th><td>{{ intervention.has_drawbacks|yesno:_("ja,nee") }}</td>
            </tr>
            {% if intervention.has_drawbacks %}
            <tr>
                <th>{% get_verbose_field_name "interventions" "intervention" "has_drawbacks_details" %}</th><td>{{ intervention.has_drawbacks_details }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "interventions" "intervention" "is_supervised" %}</th><td>{{ intervention.is_supervised|yesno:_("ja,nee") }}</td>
            </tr>
        </table>
        {% endwith %}
        {% endif %}

        {% if study.has_sessions %}
        <pdf:nextpage />
        <h2>Nadere specificatie van de takenstudie (of het takenonderzoeksdeel van de studie)</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "sessions_number" %}</th><td>{{ study.sessions_number }}</td>
            </tr>
        </table>

        {% for session in study.session_set.all %}
        <h2>Sessie {{ session.order }}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "tasks" "session" "tasks_number" %}</th><td>{{ session.tasks_number }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "tasks" "session" "tasks_duration" %}</th><td>{{ session.tasks_duration }}</td>
            </tr>
        </table>
        {% for task in session.task_set.all %}
        <h3>Taak {{ task.order }}</h3>
        <table>
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "name" %}</th><td>{{ task.name }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "description" %}</th><td>{{ task.description }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "duration" %}</th><td>{{ task.duration }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "registrations" %}</th><td>{{ task.registrations.all|unordered_list }}</td>
            </tr>
            {% if task.registrations.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "registrations_details" %}</th><td>{{ task.registrations_details }}</td>
            </tr>
            {% endif %}
            {% if task.registrations.all|needs_details:"needs_kind" %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "registration_kinds" %}</th><td>{{ task.registration_kinds.all|unordered_list }}</td>
            </tr>
            {% if task.registration_kinds.all|needs_details %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "registration_kinds_details" %}</th><td>{{ task.registration_kinds_details }}</td>
            </tr>
            {% endif %}
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "feedback" %}</th><td>{{ task.feedback|yesno:_("ja,nee") }}</td>
            </tr>
            {% if task.feedback %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "feedback_details" %}</th><td>{{ task.feedback_details }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "deception" %}</th><td>{{ task.deception|yesno:_("ja,nee") }}</td>
            </tr>
            {% if task.deception %}
            <tr>
                <th>{% get_verbose_field_name "tasks" "task" "deception_details" %}</th><td>{{ task.deception_details }}</td>
            </tr>
            {% endif %}
        </table>
        {% endfor %}
        {% endfor %}
        {% endif %}

        <pdf:nextpage />
        <h2>{% trans "Informatie over de belasting en de risico's" %}</h2>
        <table>
            {% if study.has_sessions %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "sessions_duration" %}</th><td>{{ study.sessions_duration }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "stressful" %}</th><td>{{ study.stressful|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            {% if study.stressful %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "stressful_details" %}</th><td>{{ study.stressful_details }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "risk" %}</th><td>{{ study.risk|yesno:_("ja,nee,twijfel") }}</td>
            </tr>
            {% if study.risk %}
            <tr>
                <th>{% get_verbose_field_name "studies" "study" "risk_details" %}</th><td>{{ study.risk_details }}</td>
            </tr>
            {% endif %}
        </table>

        <pdf:nextpage />
        <h2>{% trans "Dataverzameling direct betrokkenen" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "has_surveys" %}</th><td>{{ study.has_surveys|yesno:_("ja,nee") }}</td>
            </tr>
            {% if study.has_surveys %}
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "surveys_stressful" %}</th><td>{{ study.surveys_stressful }}</td>
            </tr>
            {% endif %}
        </table>
        {% for survey in study.survey_set.all %}
        <h3>Vragenlijst</h3>
        <table>
            <tr>
                <th>{% get_verbose_field_name "proposals" "survey" "name" %}</th><td>{{ survey.name }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "survey" "minutes" %}</th><td>{{ survey.minutes }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "survey" "survey_url" %}</th><td>{{ survey.survey_url }}</td>
            </tr>
            <tr>
                <th>{% get_verbose_field_name "proposals" "survey" "description" %}</th><td>{{ survey.description }}</td>
            </tr>
        </table>
        {% endfor %}

        <pdf:nextpage />
        <h2>{% trans "Concept-aanmelding versturen" %}</h2>
        <table>
            <tr>
                <th>{% get_verbose_field_name "proposals" "proposal" "comments" %}</th><td>{{ proposal.comments }}</td>
            </tr>
        </table>

        {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}
