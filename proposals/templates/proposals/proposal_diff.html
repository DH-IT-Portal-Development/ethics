{% extends "base/base.html" %}

{% load i18n %}
{% load proposal_filters %}

{% block title %}
{% trans "Verschillen" %}
{% endblock %}

{% block content %}
{% with p_proposal=proposal.parent %}
<h2>{% trans "Algemene informatie over de studie" %}</h2>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "relation" %}</th>
        <td>{{ p_proposal.relation }}</td>
        <td>{{ proposal.relation }}</td>
    </tr>
    {% if proposal.relation.needs_supervisor or p_proposal.relation.needs_supervisor %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "supervisor" %}</th>
        <td>{{ p_proposal.supervisor.get_full_name }}</td>
        <td>{{ proposal.supervisor.get_full_name }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "other_applicants" %}</th>
        <td>{{ p_proposal.other_applicants|yesno:_("ja,nee") }}</td>
        <td>{{ proposal.other_applicants|yesno:_("ja,nee") }}</td>
    </tr>
    {% if proposal.other_applicants or p_proposal.other_applicants %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "applicants" %}</th>
        <td>{{ p_proposal.applicants.all|unordered_list }}</td>
        <td>{{ proposal.applicants.all|unordered_list }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "other_stakeholders" %}</th>
        <td>{{ p_proposal.other_stakeholders|yesno:_("ja,nee") }}</td>
        <td>{{ proposal.other_stakeholders|yesno:_("ja,nee") }}</td>
    </tr>
    {% if proposal.other_stakeholders or p_proposal.other_stakeholders %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "stakeholders" %}</th>
        <td>{{ p_proposal.stakeholders }}</td>
        <td>{{ proposal.stakeholders }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "date_start" %}</th>
        <td>{{ p_proposal.date_start|default:_("onbekend") }}</td>
        <td>{{ proposal.date_start|default:_("onbekend") }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "title" %}</th>
        <td>{{ p_proposal.title }}</td>
        <td>{{ proposal.title }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "summary" %}</th>
        <td>{{ p_proposal.summary }}</td>
        <td>{{ proposal.summary }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "funding" %}</th>
        <td>{{ p_proposal.funding.all|unordered_list }}</td>
        <td>{{ proposal.funding.all|unordered_list }}</td>
    </tr>
    {% if proposal.funding.all|needs_details or p_proposal.funding.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "funding_details" %}</th>
        <td>{{ p_proposal.funding_details }}</td>
        <td>{{ proposal.funding_details }}</td>
    </tr>
    {% endif %}
</table>

{% with wmo=proposal.wmo %}
{% with p_wmo=p_proposal.wmo %}
<h2>{% trans "Ethische toetsing nodig door een Medische Ethische ToetsingsCommissie (METC)?" %}</h2>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc" %}</th>
        <td>{{ p_wmo.get_metc_display }}</td>
        <td>{{ wmo.get_metc_display }}</td>
    </tr>
    {% if wmo.metc == 'Y' or p_wmo.metc == 'Y' %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc_details" %}</th>
        <td>{{ p_wmo.metc_details }}</td>
        <td>{{ wmo.metc_details }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc_institution" %}</th>
        <td>{{ p_wmo.metc_institution }}</td>
        <td>{{ wmo.metc_institution }}</td>
    </tr>
    {% else %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "is_medical" %}</th>
        <td>{{ p_wmo.get_is_medical_display }}</td>
        <td>{{ wmo.get_is_medical_display }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "is_behavioristic" %}</th>
        <td>{{ p_wmo.get_is_behavioristic_display }}</td>
        <td>{{ wmo.get_is_behavioristic_display }}</td>
    </tr>
    {% endif %}
</table>

{% if wmo.status != wmo.NO_WMO or p_wmo.status != p_wmo.NO_WMO %}
<h2>{% trans "Aanmelding bij de METC" %}</h2>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc_application" %}</th>
        <td>{{ p_wmo.metc_application|yesno:_("ja,nee") }}</td>
        <td>{{ wmo.metc_application|yesno:_("ja,nee") }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc_decision" %}</th>
        <td>{{ p_wmo.metc_decision|yesno:_("ja,nee") }}</td>
        <td>{{ wmo.metc_decision|yesno:_("ja,nee") }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "wmo" "metc_decision_pdf" %}</th>
        {% if p_wmo.metc_decision_pdf %}
        <td><a href="{{ p_wmo.metc_decision_pdf.url }}" target="_blank">{% trans "Download" %}</a></td>
        {% endif %}
        {% if wmo.metc_decision_pdf %}
        <td><a href="{{ wmo.metc_decision_pdf.url }}" target="_blank">{% trans "Download" %}</a></td>
        {% endif %}
    </tr>
</table>
{% endif %}
{% endwith %}
{% endwith %}

<h2>{% trans "EÃ©n of meerdere trajecten?" %}</h2>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "studies_similar" %}</th>
        <td>{{ p_proposal.studies_similar|yesno:_("ja,nee") }}</td>
        <td>{{ proposal.studies_similar|yesno:_("ja,nee") }}</td>
    </tr>
    {% if not proposal.studies_similar or not p_proposal.studies_similar %}
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "studies_number" %}</th>
        <td>{{ p_proposal.studies_number }}</td>
        <td>{{ proposal.studies_number }}</td>
    </tr>
    {% endif %}
</table>

{% if proposal.wmo.status == proposal.wmo.NO_WMO %}
{% for study in proposal.study_set.all %}
{% for p_study in p_proposal.study_set.all %}
<h2>{% trans "De deelnemers" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "age_groups" %}</th>
        <td>{{ p_study.age_groups.all|unordered_list }}</td>
        <td>{{ study.age_groups.all|unordered_list }}</td>
    </tr>
    {% if study|has_adults or p_study|has_adults %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "legally_incapable" %}</th>
        <td>{{ p_study.legally_incapable|yesno:_("ja,nee") }}</td>
        <td>{{ study.legally_incapable|yesno:_("ja,nee") }}</td>
    </tr>
    {% if study.legally_incapable or p_study.legally_incapable %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "legally_incapable_details" %}</th>
        <td>{{ p_study.legally_incapable_details }}</td>
        <td>{{ study.legally_incapable_details }}</td>
    </tr>
    {% endif %}
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "has_traits" %}</th>
        <td>{{ p_study.has_traits|yesno:_("ja,nee") }}</td>
        <td>{{ study.has_traits|yesno:_("ja,nee") }}</td>
    </tr>
    {% if study.has_traits or p_study.has_traits %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "traits" %}</th>
        <td>{{ p_study.traits.all|unordered_list }}</td>
        <td>{{ study.traits.all|unordered_list }}</td>
    </tr>
    {% if study.traits.all|needs_details or p_study.traits.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "traits_details" %}</th>
        <td>{{ p_study.traits_details }}</td>
        <td>{{ study.traits_details }}</td>
    </tr>
    {% endif %}
    {% endif %}
    {% if study|necessity_required or p_study|necessity_required %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "necessity" %}</th>
        <td>{{ p_study.get_necessity_display }}</td>
        <td>{{ study.get_necessity_display }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "necessity_reason" %}</th>
        <td>{{ p_study.necessity_reason }}</td>
        <td>{{ study.necessity_reason }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "recruitment" %}</th>
        <td>{{ p_study.recruitment.all|unordered_list }}</td>
        <td>{{ study.recruitment.all|unordered_list }}</td>
    </tr>
    {% if study.recruitment.all|needs_details or p_study.recruitment.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "recruitment_details" %}</th>
        <td>{{ p_study.recruitment_details }}</td>
        <td>{{ study.recruitment_details }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "compensation" %}</th>
        <td>{{ p_study.compensation }}</td>
        <td>{{ study.compensation }}</td>
    </tr>
    {% if study.compensation.needs_details or p_study.compensation.needs_details %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "compensation_details" %}</th>
        <td>{{ p_study.compensation_details }}</td>
        <td>{{ study.compensation_details }}</td>
    </tr>
    {% endif %}
</table>

{% if study.has_intervention %}
{% with intervention=study.intervention p_intervention=p_study.intervention %}
<h2>{% trans "Het interventieonderzoek" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "setting" %}</th>
        <td>{{ p_intervention.setting.all|unordered_list }}</td>
        <td>{{ intervention.setting.all|unordered_list }}</td>
    </tr>
    {% if intervention.setting.all|needs_details or p_intervention.setting.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "setting_details" %}</th>
        <td>{{ p_intervention.setting_details }}</td>
        <td>{{ intervention.setting_details }}</td>
    </tr>
    {% endif %}
    {% if intervention.setting.all|needs_details:"needs_supervision" or p_intervention.setting.all|needs_details:"needs_supervision" %}
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "supervision" %}</th>
        <td>{{ p_intervention.supervision|yesno:_("ja,nee") }}</td>
        <td>{{ intervention.supervision|yesno:_("ja,nee") }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "period" %}</th>
        <td>{{ p_intervention.period }}</td>
        <td>{{ intervention.period }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "amount_per_week" %}</th>
        <td>{{ p_intervention.amount_per_week }}</td>
        <td>{{ intervention.amount_per_week }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "duration" %}</th>
        <td>{{ p_intervention.duration }}</td>
        <td>{{ intervention.duration }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "measurement" %}</th>
        <td>{{ p_intervention.measurement }}</td>
        <td>{{ intervention.measurement }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "experimenter" %}</th>
        <td>{{ p_intervention.experimenter }}</td>
        <td>{{ intervention.experimenter }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "description" %}</th>
        <td>{{ p_intervention.description }}</td>
        <td>{{ intervention.description }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "has_controls" %}</th>
        <td>{{ p_intervention.has_controls|yesno:_("ja,nee") }}</td>
        <td>{{ intervention.has_controls|yesno:_("ja,nee") }}</td>
    </tr>
    {% if intervention.has_controls or p_intervention.has_controls %}
    <tr>
        <th>{% get_verbose_field_name "interventions" "intervention" "controls_description" %}</th>
        <td>{{ p_intervention.controls_description }}</td>
        <td>{{ intervention.controls_description }}</td>
    </tr>
    {% endif %}
</table>
{% endwith %}
{% endif %}

{% if study.has_observation %}
{% with observation=study.observation p_observation=p_study.observation %}
<h2>{% trans "Het observatieonderzoek" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "setting" %}</th>
        <td>{{ p_observation.setting.all|unordered_list }}</td>
        <td>{{ observation.setting.all|unordered_list }}</td>
    </tr>
    {% if observation.setting.all|needs_details or p_observation.setting.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "setting_details" %}</th>
        <td>{{ p_observation.setting_details }}</td>
        <td>{{ observation.setting_details }}</td>
    </tr>
    {% endif %}
    {% if observation.setting.all|needs_details:"needs_supervision" or p_observation.setting.all|needs_details:"needs_supervision" %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "supervision" %}</th>
        <td>{{ p_observation.supervision|yesno:_("ja,nee") }}</td>
        <td>{{ observation.supervision|yesno:_("ja,nee") }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "days" %}</th>
        <td>{{ p_observation.days }}</td>
        <td>{{ observation.days }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "mean_hours" %}</th>
        <td>{{ p_observation.mean_hours }}</td>
        <td>{{ observation.mean_hours }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "is_anonymous" %}</th>
        <td>{{ p_observation.is_anonymous|yesno:_("ja,nee") }}</td>
        <td>{{ observation.is_anonymous|yesno:_("ja,nee") }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "is_in_target_group" %}</th>
        <td>{{ p_observation.is_in_target_group|yesno:_("ja,nee") }}</td>
        <td>{{ observation.is_in_target_group|yesno:_("ja,nee") }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "is_nonpublic_space" %}</th>
        <td>{{ p_observation.is_nonpublic_space|yesno:_("ja,nee") }}</td>
        <td>{{ observation.is_nonpublic_space|yesno:_("ja,nee") }}</td>
    </tr>
    {% if observation.is_nonpublic_space or p_observation.is_nonpublic_space %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "has_advanced_consent" %}</th>
        <td>{{ p_observation.has_advanced_consent|yesno:_("ja,nee") }}</td>
        <td>{{ observation.has_advanced_consent|yesno:_("ja,nee") }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "needs_approval" %}</th>
        <td>{{ p_observation.needs_approval|yesno:_("ja,nee") }}</td>
        <td>{{ observation.needs_approval|yesno:_("ja,nee") }}</td>
    </tr>
    {% if observation.needs_approval or p_observation.is_nonpublic_space %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "approval_institution" %}</th>
        <td>{{ p_observation.approval_institution }}</td>
        <td>{{ observation.approval_institution }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "approval_document" %}</th>
        <td><a href="{{ p_observation.approval_document.url }}" target="_blank">{% trans "Download" %}</a></td>
        <td><a href="{{ observation.approval_document.url }}" target="_blank">{% trans "Download" %}</a></td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "registrations" %}</th>
        <td>{{ p_observation.registrations.all|unordered_list }}</td>
        <td>{{ observation.registrations.all|unordered_list }}</td>
    </tr>
    {% if observation.registrations.all|needs_details or p_observation.registrations.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "observations" "observation" "registrations_details" %}</th>
        <td>{{ p_observation.registrations_details }}</td>
        <td>{{ observation.registrations_details }}</td>
    </tr>
    {% endif %}
</table>
{% endwith %}
{% endif %}

{% if study.has_sessions %}
<h2>{% trans "Het takenonderzoek" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "sessions_number" %}</th>
        <td>{{ p_study.sessions_number }}</td>
        <td>{{ study.sessions_number }}</td>
    </tr>
</table>

{% for session in study.session_set.all %}
{% for p_session in p_study.session_set.all %}
{% include "tasks/session_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "session" "setting" %}</th>
        <td>{{ p_session.setting.all|unordered_list }}</td>
        <td>{{ session.setting.all|unordered_list }}</td>
    </tr>
    {% if session.setting.all|needs_details or p_session.setting.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "session" "setting_details" %}</th>
        <td>{{ p_session.setting_details }}</td>
        <td>{{ session.setting_details }}</td>
    </tr>
    {% endif %}
    {% if session.setting.all|needs_details:"needs_supervision" or p_session.setting.all|needs_details:"needs_supervision" %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "session" "supervision" %}</th>
        <td>{{ p_session.supervision|yesno:_("ja,nee") }}</td>
        <td>{{ session.supervision|yesno:_("ja,nee") }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "session" "tasks_number" %}</th>
        <td>{{ p_session.tasks_number }}</td>
        <td>{{ session.tasks_number }}</td>
    </tr>
</table>
{% for task in session.task_set.all %}
{% for p_task in p_session.task_set.all %}
{% include "tasks/task_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "name" %}</th>
        <td>{{ p_task.name }}</td>
        <td>{{ task.name }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "description" %}</th>
        <td>{{ p_task.description }}</td>
        <td>{{ task.description }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "duration" %}</th>
        <td>{{ p_task.duration }}</td>
        <td>{{ task.duration }}</td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "registrations" %}</th>
        <td>{{ p_task.registrations.all|unordered_list }}</td>
        <td>{{ task.registrations.all|unordered_list }}</td>
    </tr>
    {% if task.registrations.all|needs_details or p_task.registrations.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "registrations_details" %}</th>
        <td>{{ p_task.registrations_details }}</td>
        <td>{{ task.registrations_details }}</td>
    </tr>
    {% endif %}
    {% if task.registrations.all|needs_details:"needs_kind" or p_task.registrations.all|needs_details:"needs_kind" %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "registration_kinds" %}</th>
        <td>{{ p_task.registration_kinds.all|unordered_list }}</td>
        <td>{{ task.registration_kinds.all|unordered_list }}</td>
    </tr>
    {% if task.registration_kinds.all|needs_details or p_task.registration_kinds.all|needs_details %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "registration_kinds_details" %}</th>
        <td>{{ p_task.registration_kinds_details }}</td>
        <td>{{ task.registration_kinds_details }}</td>
    </tr>
    {% endif %}
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "feedback" %}</th>
        <td>{{ p_task.feedback|yesno:_("ja,nee") }}</td>
        <td>{{ task.feedback|yesno:_("ja,nee") }}</td>
    </tr>
    {% if task.feedback or p_task.feedback %}
    <tr>
        <th>{% get_verbose_field_name "tasks" "task" "feedback_details" %}</th>
        <td>{{ p_task.feedback_details }}</td>
        <td>{{ task.feedback_details }}</td>
    </tr>
    {% endif %}
</table>
{% endfor %}
{% endfor %}

<h3>{% trans "Overzicht van het takenonderzoek" %}</h3>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "tasks" "session" "tasks_duration" session.net_duration %}</th>
        <td>{{ p_session.tasks_duration }}</td>
        <td>{{ session.tasks_duration }}</td>
    </tr>
</table>
{% endfor %}
{% endfor %}
{% endif %}

<h2>{% trans "Overzicht en eigen beoordeling van het gehele onderzoek" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    {% if study.has_sessions or p_study.has_sessions %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "deception" %}</th>
        <td>{{ p_study.get_deception_display }}</td>
        <td>{{ study.get_deception_display }}</td>
    </tr>
    {% if study.deception == 'Y' or study.deception == '?' or p_study.deception == 'Y' or p_study.deception == '?' %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "deception_details" %}</th>
        <td>{{ p_study.deception_details }}</td>
        <td>{{ study.deception_details }}</td>
    </tr>
    {% endif %}
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "negativity" %}</th>
        <td>{{ p_study.get_negativity_display }}</td>
        <td>{{ study.get_negativity_display }}</td>
    </tr>
    {% if study.negativity == 'Y' or study.negativity == '?' or p_study.negativity == 'Y' or p_study.negativity == '?' %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "negativity_details" %}</th>
        <td>{{ p_study.negativity_details }}</td>
        <td>{{ study.negativity_details }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "stressful" %}</th>
        <td>{{ p_study.get_stressful_display }}</td>
        <td>{{ study.get_stressful_display }}</td>
    </tr>
    {% if study.stressful == 'Y' or study.stressful == '?' or p_study.stressful == 'Y' or p_study.stressful == '?' %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "stressful_details" %}</th>
        <td>{{ p_study.stressful_details }}</td>
        <td>{{ study.stressful_details }}</td>
    </tr>
    {% endif %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "risk" %}</th>
        <td>{{ p_study.get_risk_display }}</td>
        <td>{{ study.get_risk_display }}</td>
    </tr>
    {% if study.risk == 'Y' or study.risk == '?' or p_study.risk == 'Y' or p_study.risk == '?' %}
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "risk_details" %}</th>
        <td>{{ p_study.risk_details }}</td>
        <td>{{ study.risk_details }}</td>
    </tr>
    {% endif %}
</table>

<h2>{% trans "Informed consent formulieren voor het onderzoek" %}</h2>
{% include "studies/study_title.html" %}
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "informed_consent" %}</th>
        <td><a href="{{ p_study.informed_consent.url }}" target="_blank">{% trans "Download" %}</a></td>
        <td><a href="{{ study.informed_consent.url }}" target="_blank">{% trans "Download" %}</a></td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "briefing" %}</th>
        <td><a href="{{ p_study.briefing.url }}" target="_blank">{% trans "Download" %}</a></td>
        <td><a href="{{ study.briefing.url }}" target="_blank">{% trans "Download" %}</a></td>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "studies" "study" "passive_consent" %}</th>
        <td>{{ p_study.passive_consent|yesno:_("ja,nee") }}</td>
        <td>{{ study.passive_consent|yesno:_("ja,nee") }}</td>
    </tr>
</table>
{% endfor %}
{% endfor %}

<h2>{% trans "Concept-aanmelding versturen" %}</h2>
<table class="proposals-diff pure-table pure-table-horizontal">
    <tr>
        <th class="proposals-diff-question"></th>
        <th class="proposals-diff-answer">{% trans "Originele studie" %}</th>
        <th class="proposals-diff-answer">{% trans "Revisie/amendement" %}</th>
    </tr>
    <tr>
        <th>{% get_verbose_field_name "proposals" "proposal" "comments" %}</th>
        <td>{{ p_proposal.comments }}</td>
        <td>{{ proposal.comments }}</td>
    </tr>
</table>
{% endif %}
{% endwith %}

<script>
$(function() {
    // Color changes between proposals as red
    $('td:nth-child(2)').each(function() {
        if ($(this).text() !== $(this).next().text()) {
            $(this).next().css('background-color', 'orange');
        }
    });
});
</script>
{% endblock %}
