{% extends "proposals/base.html" %}
{% load staticfiles %}

{% block title %} 
Aanvraag indienen: fase 3 van 6
{% endblock %} 

{% block content %} 
{% include "proposals/form_styling.html" %}
<script>
$(function() {
    depends_on_value('has_traits', 'True', 'traits');
    depends_on_value('has_traits', 'True', 'traits_details');
    depends_on_list_value('traits', '10', 'traits_details');
    depends_on_value('necessity', 'True', 'necessity_reason');
    depends_on_list_value('setting', '8', 'setting_details');
    depends_on_list_value('compensation', ['2', '3'], 'compensation_details');
    depends_on_list_value('recruitment', '7', 'recruitment_details');

    add_title('age_groups', 'De leeftijdsgroep van uw proefpersonen');
    add_title('has_traits', 'Bijzondere kenmerken van de proefpersonen');
    add_title('necessity', 'Noodzakelijkheid');
    add_title('setting', 'Setting');
    add_title('risk_physical', 'Risico op letsel');
    add_title('compensation', 'Vergoeding');
    add_title('recruitment', 'Werving');

    // Logic for necessity display. TODO: change into AJAX call, solve this on model level
    $('input[name=has_traits], input[name=age_groups]').change(function() {
        var values = $('input[name=age_groups]:checked').map(function() {
            return this.value;
        }).get();
        var check = $('input[name=has_traits]:checked').val() == 'True';
        check = check || intersect(values, ['1', '2', '3', '4', '6']).length > 0;
        $('#id_necessity').parent().parent().toggle(check);
    });
    $('input[name=has_traits], input[name=age_groups]').change();
});
</script>
<h3>Algemene kenmerken van de studie</h3>
<form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table>{{ form.as_table }}</table>
    <h4>Surveys</h4>
    {% for formset in inlines %}
    <div id="{{ formset.prefix }}">
    {% for subform in formset.forms %}
        <table>
        {{ subform.as_ul }}
        </table>
    {% endfor %}
    {{ formset.management_form }}
    </div>
    {% endfor %}
    <input class="pure-button pure-button-primary" type="submit" name="save" value="Opslaan en terug naar hoofdmenu" />
    <input class="pure-button pure-button-primary" type="submit" name="save_continue" value="Opslaan en naar volgende stap" />
    <a class="pure-button pure-button-secondary" href="{% url 'proposals:my_concepts' %}">Terug naar hoofdmenu</a>
</form>
{% endblock %}
