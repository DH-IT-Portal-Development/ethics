{% extends "base/base.html" %}

{% load staticfiles %}
{% load i18n %}

{% block title %} 
{% trans "Deelnemers-gerelateerde informatie en informed consent" %}
{% endblock %}

{% block progress %}10{% endblock %}

{% block content %}
<script>
$(function() {
    check_field_required('setting', 'needs_details', 'setting_details');
    check_field_required('compensation', 'needs_details', 'compensation_details');
    check_field_required('recruitment', 'needs_details', 'recruitment_details');

    add_title('age_groups', "{% trans 'De leeftijdsgroep van uw deelnemers' %}");
    add_title('legally_incapable', "{% trans 'Wilsonbekwaamheid' %}");
    add_title('has_traits', "{% trans 'Bijzondere kenmerken van de deelnemers' %}");
    add_title('necessity', "{% trans 'Noodzakelijkheid' %}");
    add_title('setting', "{% trans 'Setting' %}");
    add_title('compensation', "{% trans 'Vergoeding' %}");
    add_title('recruitment', "{% trans 'Werving' %}");
    add_title('informed_consent_pdf', "{% trans 'Informed consent' %}");

    // Logic for necessity display.
    $('input[name=age_groups], input[name=legally_incapable], input[name=has_traits]').change(function() {
        var age_groups = $('input[name=age_groups]:checked').map(function() {
            return this.value;
        }).get();
        var legally_incapable = $('input[name=legally_incapable]:checked').val();
        var has_traits = $('input[name=has_traits]:checked').val();

        var url = "{% url 'proposals:check_necessity_required' %}";
        var params = {'age_groups': age_groups,
            'legally_incapable': legally_incapable,
            'has_traits': has_traits};
        $.post(url, params, function(data) {
            $('#id_necessity, #id_necessity_reason').parents('tr').toggle(data.result);
            $('#id_necessity').parents('tr').prev().toggle(data.result); // Toggles header as well
        });
    });
    $('input[name=age_groups], input[name=legally_incapable], input[name=has_traits]').change();
});
</script>
<form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
    <table>{{ form.as_table }}</table>
    {% with proposal=study.proposal %}
    {% include "proposals/form_buttons.html" %}
    {% endwith %}
</form>
{% endblock %}
